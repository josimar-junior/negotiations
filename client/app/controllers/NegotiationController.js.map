{"version":3,"sources":["../../app-src/controllers/NegotiationController.js"],"names":["Negotiations","NegotiantionService","Negotiation","NegotiationsView","MessageView","Message","DateConverter","getNegotiationDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegotiationController","constructor","_inputDate","_inputQuantity","_inputValue","Object","assign","_negotiations","_message","_negotiationService","_init","dao","negotiations","listAll","forEach","save","negotiation","error","text","event","preventDefault","_createNegotiation","_cleanForm","toDate","value","parseInt","parseFloat","focus","clear","importNegotiations","getNegotiationsForThePeriod","filter","toArray","some","newNegotiation","equals","existingNegotiation"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["import { Negotiations, NegotiantionService, Negotiation } from '../domain/index.js';\nimport { NegotiationsView, MessageView, Message, DateConverter } from '../ui/index.js';\nimport { getNegotiationDao, Bind, getExceptionMessage, debounce, controller, bindEvent } from '../util/index.js';\n\n@controller('#date', '#quantity', '#value')\nexport class NegotiationController {\n\n    constructor(_inputDate, _inputQuantity, _inputValue) {\n\n        Object.assign(this, {_inputDate, _inputQuantity, _inputValue});\n\n        this._negotiations = new Bind(new Negotiations(), new NegotiationsView('#negotiations'), 'save', 'clear');\n\n        this._message = new Bind(new Message(), new MessageView('#messageView'), 'text');\n\n        this._negotiationService = new NegotiantionService();\n\n        this._init();\n    }\n\n    async _init() {\n        try {\n            const dao = await getNegotiationDao();\n            const negotiations = await dao.listAll();\n            negotiations.forEach(negotiation => this._negotiations.save(negotiation));\n        } catch (error) {\n            this._message.text = getExceptionMessage(error);\n        }\n    }\n\n    @bindEvent('submit', '.form')\n    @debounce()\n    async save(event) {\n        try {\n            event.preventDefault();\n\n            const negotiation = this._createNegotiation();\n\n            const dao = await getNegotiationDao();\n            await dao.save(negotiation);\n            this._negotiations.save(this._createNegotiation());\n            this._message.text = 'Negotiation saved successfully';\n            this._cleanForm();\n\n        } catch (error) {\n            this._message.text = getExceptionMessage(error);\n        }\n    }\n\n    _createNegotiation() {\n        return new Negotiation(DateConverter.toDate(this._inputDate.value),\n            parseInt(this._inputQuantity.value),\n            parseFloat(this._inputValue.value));\n    }\n\n    _cleanForm() {\n        this._inputDate.value = '';\n        this._inputQuantity.value = 1;\n        this._inputValue.value = 0.0;\n        this._inputDate.focus();\n    }\n\n    @bindEvent('click', '#btn-clear')\n    async clear() {\n        try {\n            const dao = await getNegotiationDao();\n            await dao.clear();\n            this._negotiations.clear();\n            this._message.text = 'Negotiations successfully deleted';\n        } catch (error) {\n            this._message.text = getExceptionMessage(error);\n        }\n    }\n\n    @bindEvent('click', '#btn-import')\n    @debounce()\n    async importNegotiations() {\n        try {\n            const negotiations = await this._negotiationService.getNegotiationsForThePeriod();\n            negotiations.filter(newNegotiation => !this._negotiations.toArray().some(existingNegotiation =>\n                newNegotiation.equals(existingNegotiation)))\n                .forEach(negotiation => this._negotiations.save(negotiation));\n\n            this._message.text = 'Negotiations imported of the period successfully';\n        } catch (error) {\n            this._message.text = getExceptionMessage(error);\n        }\n    }\n\n}"]}