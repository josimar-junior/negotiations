webpackJsonp([0],[,,function(a,b,c){"use strict";function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function e(a){return a instanceof v||Object.getPrototypeOf(a)instanceof v}function f(a){return e(a)?a.message:(console.log(a),"There was a problem. Contact support.")}function g(a=500){return function(b,c,d){const e=d.value;let f=0;return d.value=function(...b){clearTimeout(f),f=setTimeout(()=>e.apply(this,b),a)},d}}function h(a,b){document.querySelector(b.selector).addEventListener(b.event,(c)=>{b.prevent&&c.preventDefault(),a[b.key](c)})}function i(a){throw new Error(`${a} is required`)}function j(a=i("event"),b=i("selector"),c=!0){return function(d,e,f){return Reflect.defineMetadata("bindEvent",{event:a,selector:b,prevent:c,key:e},Object.getPrototypeOf(d),e),f}}function k(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function l(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function m(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}Object.defineProperty(b,"__esModule",{value:!0});let n=class a{static create(b,c,d){return new Proxy(b,{get(b,e){return a._isFunction(b[e])&&c.includes(e)?function(){console.log(`${e} fired the trap`),b[e].apply(b,arguments),d(b)}:b[e]},set(a,b,e){const f=Reflect.set(a,b,e);return c.includes(b)&&d(a),f}})}static _isFunction(a){return typeof a==typeof Function}},o=class{constructor(a,b,...c){const d=n.create(a,c,(a)=>{b.update(a)});return b.update(a),d}};const p=["negotiations"];let q=null,r=null,s=class a{constructor(){throw new Error("Can't create instances of this class")}static getConnection(){return new Promise((b,c)=>{if(q)return b(q);const d=indexedDB.open("js",1);d.onupgradeneeded=(b)=>{a._createStores(b.target.result)},d.onsuccess=(a)=>{q=a.target.result,r=q.close.bind(q),q.close=()=>{throw new Error("You can't close the connection directly")},b(q)},d.onerror=(a)=>{console.log(a.target.error),c(a.target.error.name)}})}static _createStores(a){p.forEach((b)=>{a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),a.createObjectStore(b,{autoIncrement:!0})})}static closeConnection(){q&&r()}},t=class{constructor(a){this._connection=a,this._store="negotiations"}save(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(a);d.onsuccess=()=>b(),d.onerror=(a)=>{console.log(a.target.error),c("Error saving negotiation")}})}listAll(){return new Promise((a,b)=>{const c=[],d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();d.onsuccess=(b)=>{const d=b.target.result;if(d){const a=new x(d.value._date,d.value._quantity,d.value._value);c.push(a),d.continue()}else a(c)},d.onerror=(a)=>{console.log(a.target.error),b("Error listing negotiations")}})}clear(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();c.onsuccess=()=>a(),c.onerror=(a)=>{console.log(a.target.error),b("Error deleting the negotiations")}})}},u=(()=>{var a=d(function*(){let a=yield s.getConnection();return new t(a)});return function(){return a.apply(this,arguments)}})(),v=class extends Error{constructor(a=""){super(a),this.name=this.constructor.name}},w=class{_handleErrors(a){if(a.ok)return a;throw new Error(a.statusText)}get(a){return fetch(a).then((a)=>this._handleErrors(a)).then((a)=>a.json())}},x=class{constructor(a=i("date"),b=i("quantity"),c=i("value")){Object.assign(this,{_quantity:b,_value:c}),this._date=new Date(a.getTime()),Object.freeze(this)}get date(){return new Date(this._date.getTime())}get quantity(){return this._quantity}get value(){return this._value}get volume(){return this._quantity*this._value}equals(a){return JSON.stringify(this)==JSON.stringify(a)}},y=class{constructor(){this._negotiations=[],Object.freeze(this)}save(a){this._negotiations.push(a)}toArray(){return[].concat(this._negotiations)}get totalVolume(){return this._negotiations.reduce((a,b)=>a+b.volume,0)}clear(){this._negotiations.length=0}},z=class{constructor(){this._httpService=new w}getWeekNegotiations(){return this._httpService.get("http://localhost:3000/negotiations/week").then((a)=>a.map((a)=>new x(new Date(a.date),a.quantity,a.value)),()=>{throw new v("Couldn't get week negotiations")})}getPreviousWeekNegotiations(){return this._httpService.get("http://localhost:3000/negotiations/previous").then((a)=>a.map((a)=>new x(new Date(a.date),a.quantity,a.value)),()=>{throw new v("Couldn't get previous week negotiations")})}getDelayedWeekNegotiations(){return this._httpService.get("http://localhost:3000/negotiations/delayed").then((a)=>a.map((a)=>new x(new Date(a.date),a.quantity,a.value)),()=>{throw new v("Couldn't get delayed week negotiations")})}getNegotiationsForThePeriod(){var a=this;return k(function*(){try{let b=yield Promise.all([a.getWeekNegotiations(),a.getPreviousWeekNegotiations(),a.getDelayedWeekNegotiations()]);return b.reduce(function(a,b){return a.concat(b)},[]).sort(function(a,b){return b.date.getTime()-a.date.getTime()})}catch(a){throw console.log(err),new v("Couldn't get negotiations for the period")}})()}},A=class{constructor(a){this._element=document.querySelector(a)}update(a){this._element.innerHTML=this.template(a)}template(){throw new Error("You need to implement the template method")}},B=class extends A{template(a){return a.text?`<p class="alert alert-info">${a.text}</p>`:`<p></p>`}},C=class extends v{constructor(){super("Date must be in the format dd/mm/yyyy")}},D=class{constructor(){throw new Error("This class can't be instantiated")}static toText(a){return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`}static toDate(a){if(!/\d{2}\/\d{2}\/\d{4}/.test(a))throw new C;return new Date(...a.split("/").reverse().map((a,b)=>a-b%2))}},E=class extends A{template(a){return`<table class="table table-hover table-bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Quantity</th>
                            <th>Value</th>
                            <th>Volume</th>
                        </tr>
                    </thead>

                    <tbody>
                        ${a.toArray().map((a)=>`
                                <tr>
                                    <td>${D.toText(a.date)}</td>
                                    <td>${a.quantity}</td>
                                    <td>${a.value}</td>
                                    <td>${a.volume}</td>
                                </tr>
                            `).join("")}
                    </tbody>

                    <tfoot>
                            <tr>
                                <td colspan="3"></td>
                                <td>${a.totalVolume}</td>
                            </tr>
                    </tfoot>

                </table>`}},F=class{constructor(a=""){this._text=a}get text(){return this._text}set text(a){this._text=a}};var G,H,I,J,K,L,M,N;let O=(G=function(...a){const b=a.map((a)=>document.querySelector(a));return function(a){const c=a,d=function(){const a=new c(...b);Object.getOwnPropertyNames(c.prototype).forEach((b)=>{Reflect.hasMetadata("bindEvent",a,b)&&h(a,Reflect.getMetadata("bindEvent",a,b))})};return d.prototype=c.prototype,d}}("#date","#quantity","#value"),H=j("submit",".form"),I=g(),J=j("click","#btn-clear"),K=j("click","#btn-import"),L=g(),G(M=(N=class{constructor(a,b,c){Object.assign(this,{_inputDate:a,_inputQuantity:b,_inputValue:c}),this._negotiations=new o(new y(),new E("#negotiations"),"save","clear"),this._message=new o(new F(),new B("#messageView"),"text"),this._negotiationService=new z,this._init()}_init(){var a=this;return l(function*(){try{const b=yield u(),c=yield b.listAll();c.forEach(function(b){return a._negotiations.save(b)})}catch(b){a._message.text=f(b)}})()}save(a){var b=this;return l(function*(){try{a.preventDefault();const c=b._createNegotiation(),d=yield u();yield d.save(c),b._negotiations.save(b._createNegotiation()),b._message.text="Negotiation saved successfully",b._cleanForm()}catch(a){b._message.text=f(a)}})()}_createNegotiation(){return new x(D.toDate(this._inputDate.value),parseInt(this._inputQuantity.value),parseFloat(this._inputValue.value))}_cleanForm(){this._inputDate.value="",this._inputQuantity.value=1,this._inputValue.value=0,this._inputDate.focus()}clear(){var a=this;return l(function*(){try{const b=yield u();yield b.clear(),a._negotiations.clear(),a._message.text="Negotiations successfully deleted"}catch(b){a._message.text=f(b)}})()}importNegotiations(){var a=this;return l(function*(){try{const b=yield a._negotiationService.getNegotiationsForThePeriod();b.filter(function(b){return!a._negotiations.toArray().some(function(a){return b.equals(a)})}).forEach(function(b){return a._negotiations.save(b)}),a._message.text="Negotiations imported of the period successfully"}catch(b){a._message.text=f(b)}})()}},m(N.prototype,"save",[H,I],Object.getOwnPropertyDescriptor(N.prototype,"save"),N.prototype),m(N.prototype,"clear",[J],Object.getOwnPropertyDescriptor(N.prototype,"clear"),N.prototype),m(N.prototype,"importNegotiations",[K,L],Object.getOwnPropertyDescriptor(N.prototype,"importNegotiations"),N.prototype),N))||M);(function(a){var b=c(3),d=c.n(b),e=c(4),f=c.n(e),g=c(1),h=c.n(g),i=c(5),j=c.n(i);a("h1").on("click",()=>alert("Was clicked")),console.log("Function added by Bootstrap:"),console.log(a("h1").modal);const k=new x(new Date(),10,30),l=new Headers;l.set("Content-Type","application/json");const m={method:"POST",headers:l,body:JSON.stringify(k)};fetch("http://localhost:3000/negotiations",m).then(()=>console.log("Data uploaded successfully"));new O}).call(b,c(0))},function(){},function(){},function(){}],[2]);